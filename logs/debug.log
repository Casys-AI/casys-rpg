2025-01-10 16:27:45 | INFO     | api.app:lifespan:72 - Starting up...
2025-01-10 16:27:45 | INFO     | managers.dependencies:get_agent_manager:57 - Creating new AgentManager instance
2025-01-10 16:27:45 | DEBUG    | managers.dependencies:get_agent_manager:59 - Creating new GameFactory instance
2025-01-10 16:27:45 | INFO     | managers.filesystem_adapter:__init__:27 - Initializing FileSystemAdapter
2025-01-10 16:27:45 | DEBUG    | managers.filesystem_adapter:__init__:32 - Creating base directory: C:\Users\erpes\Desktop\casys-rpg\data
2025-01-10 16:27:45 | DEBUG    | managers.filesystem_adapter:__init__:39 - Creating namespace directory for raw_content: C:\Users\erpes\Desktop\casys-rpg\data\sections
2025-01-10 16:27:45 | DEBUG    | managers.filesystem_adapter:__init__:39 - Creating namespace directory for rules: C:\Users\erpes\Desktop\casys-rpg\data\cache\rules
2025-01-10 16:27:45 | DEBUG    | managers.filesystem_adapter:__init__:39 - Creating namespace directory for sections: C:\Users\erpes\Desktop\casys-rpg\data\cache\sections
2025-01-10 16:27:45 | INFO     | managers.filesystem_adapter:__init__:42 - FileSystemAdapter initialized successfully
2025-01-10 16:27:45 | DEBUG    | managers.filesystem_adapter:__init__:43 - Base path: C:\Users\erpes\Desktop\casys-rpg\data
2025-01-10 16:27:45 | DEBUG    | managers.filesystem_adapter:__init__:44 - Encoding: utf-8
2025-01-10 16:27:45 | DEBUG    | managers.cache_manager:__init__:53 - CacheManager initialized with config: StorageConfig
2025-01-10 16:27:45 | DEBUG    | managers.cache_manager:__init__:54 - Base storage path: C:\Users\erpes\Desktop\casys-rpg\data
2025-01-10 16:27:45 | DEBUG    | managers.dependencies:get_agent_manager:64 - Creating game components
2025-01-10 16:27:45 | INFO     | managers.state_manager:__init__:45 - Initializing StateManager
2025-01-10 16:27:45 | DEBUG    | managers.state_manager:__init__:52 - StateManager initialized with config: base_path=WindowsPath('data') encoding='utf-8' max_cache_size=1000 game_id=None manager_id='' persistence_enabled=True debug=False cache_enabled=True options={} namespaces={'state': NamespaceConfig(path=WindowsPath('cache/games/{game_id}/states'), format=<StorageFormat.JSON: 'json'>, ttl_seconds=3600, cache_enabled=True, per_game=True), 'trace': NamespaceConfig(path=WindowsPath('cache/games/{game_id}/traces'), format=<StorageFormat.JSON: 'json'>, ttl_seconds=None, cache_enabled=True, per_game=True), 'characters': NamespaceConfig(path=WindowsPath('cache/games/{game_id}/characters'), format=<StorageFormat.JSON: 'json'>, ttl_seconds=None, cache_enabled=True, per_game=True), 'raw_content': NamespaceConfig(path=WindowsPath('sections'), format=<StorageFormat.MARKDOWN: 'markdown'>, ttl_seconds=None, cache_enabled=False, per_game=False), 'rules': NamespaceConfig(path=WindowsPath('cache/rules'), format=<StorageFormat.MARKDOWN: 'markdown'>, ttl_seconds=None, cache_enabled=True, per_game=False), 'sections': NamespaceConfig(path=WindowsPath('cache/sections'), format=<StorageFormat.MARKDOWN: 'markdown'>, ttl_seconds=None, cache_enabled=True, per_game=False)}
2025-01-10 16:27:45 | INFO     | managers.rules_manager:__init__:30 - Initializing RulesManager
2025-01-10 16:27:45 | DEBUG    | managers.rules_manager:__init__:34 - RulesManager initialized with config: StorageConfig
2025-01-10 16:27:45 | INFO     | managers.narrator_manager:__init__:28 - Initializing NarratorManager
2025-01-10 16:27:45 | DEBUG    | managers.narrator_manager:__init__:31 - NarratorManager initialized with config: StorageConfig
2025-01-10 16:27:45 | INFO     | managers.workflow_manager:__init__:33 - Initializing WorkflowManager
2025-01-10 16:27:45 | DEBUG    | managers.workflow_manager:__init__:35 - WorkflowManager initialized with state_manager: StateManager
2025-01-10 16:27:46 | DEBUG    | managers.dependencies:get_agent_manager:72 - Initializing AgentManager with components
2025-01-10 16:27:46 | INFO     | managers.agent_manager:__init__:83 - Initializing AgentManager
2025-01-10 16:27:46 | INFO     | managers.agent_manager:__init__:95 - AgentManager initialization completed
2025-01-10 16:27:46 | INFO     | managers.dependencies:get_agent_manager:79 - AgentManager initialized successfully
2025-01-10 16:27:46 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:70 - New WebSocket connection attempt
2025-01-10 16:27:46 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:78 - WebSocket connection established
2025-01-10 16:27:46 | DEBUG    | managers.agent_manager:get_state:107 - Fetching current game state
2025-01-10 16:27:46 | DEBUG    | managers.agent_manager:get_state:109 - Current state: None
2025-01-10 16:28:03 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:158 - WebSocket disconnected
2025-01-10 16:28:03 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:172 - WebSocket connection closed
2025-01-10 16:28:04 | DEBUG    | managers.dependencies:get_agent_manager:81 - Returning existing AgentManager instance
2025-01-10 16:28:04 | DEBUG    | managers.dependencies:get_agent_manager:81 - Returning existing AgentManager instance
2025-01-10 16:28:04 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:70 - New WebSocket connection attempt
2025-01-10 16:28:04 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:78 - WebSocket connection established
2025-01-10 16:28:04 | DEBUG    | managers.agent_manager:get_state:107 - Fetching current game state
2025-01-10 16:28:04 | DEBUG    | managers.agent_manager:get_state:109 - Current state: None
2025-01-10 16:28:04 | DEBUG    | managers.agent_manager:get_state:107 - Fetching current game state
2025-01-10 16:28:04 | DEBUG    | managers.agent_manager:get_state:109 - Current state: None
2025-01-10 16:28:04 | DEBUG    | managers.dependencies:get_agent_manager:81 - Returning existing AgentManager instance
2025-01-10 16:28:04 | DEBUG    | managers.agent_manager:get_state:107 - Fetching current game state
2025-01-10 16:28:04 | DEBUG    | managers.agent_manager:get_state:109 - Current state: None
2025-01-10 16:28:04 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:158 - WebSocket disconnected
2025-01-10 16:28:04 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:172 - WebSocket connection closed
2025-01-10 16:28:05 | DEBUG    | managers.dependencies:get_agent_manager:81 - Returning existing AgentManager instance
2025-01-10 16:28:05 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:70 - New WebSocket connection attempt
2025-01-10 16:28:05 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:78 - WebSocket connection established
2025-01-10 16:28:05 | DEBUG    | managers.agent_manager:get_state:107 - Fetching current game state
2025-01-10 16:28:05 | DEBUG    | managers.agent_manager:get_state:109 - Current state: None
2025-01-10 16:28:16 | DEBUG    | managers.dependencies:get_agent_manager:81 - Returning existing AgentManager instance
2025-01-10 16:28:16 | INFO     | managers.state_manager:create_initial_state:224 - Creating initial state
2025-01-10 16:28:16 | INFO     | managers.state_manager:initialize:58 - Initializing state resources
2025-01-10 16:28:16 | DEBUG    | managers.state_manager:initialize:63 - Generated new game ID: e48e937f-430c-48a5-b35f-8fd0c3138493
2025-01-10 16:28:16 | DEBUG    | managers.state_manager:initialize:67 - Generated new session ID: 82f99646-14a1-4a8f-b219-7f807aa0e54a
2025-01-10 16:28:16 | INFO     | managers.cache_manager:update_game_id:359 - Updating game ID to: e48e937f-430c-48a5-b35f-8fd0c3138493
2025-01-10 16:28:16 | DEBUG    | managers.cache_manager:update_game_id:369 - Creating per-game directory for state: data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states
2025-01-10 16:28:16 | DEBUG    | managers.cache_manager:update_game_id:369 - Creating per-game directory for trace: data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\traces
2025-01-10 16:28:16 | DEBUG    | managers.cache_manager:update_game_id:369 - Creating per-game directory for characters: data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\characters
2025-01-10 16:28:16 | INFO     | managers.state_manager:initialize:72 - State manager initialized with game ID: e48e937f-430c-48a5-b35f-8fd0c3138493, session ID: 82f99646-14a1-4a8f-b219-7f807aa0e54a
2025-01-10 16:28:16 | DEBUG    | managers.state_manager:create_initial_state:232 - Preserved data extracted: {'session_id': '82f99646-14a1-4a8f-b219-7f807aa0e54a', 'game_id': 'e48e937f-430c-48a5-b35f-8fd0c3138493', 'section_number': 1, 'character': CharacterModel(name='Hero', stats=CharacterStats(endurance=20, chance=20, skill=20), inventory=Inventory(items={}, capacity=10, gold=0))}
2025-01-10 16:28:16 | INFO     | managers.state_manager:clear_model_nodes:581 - Clearing model nodes
2025-01-10 16:28:16 | DEBUG    | managers.state_manager:clear_model_nodes:594 - Model nodes cleared
2025-01-10 16:28:16 | DEBUG    | managers.state_manager:create_initial_state:236 - Existing state cleared
2025-01-10 16:28:16 | DEBUG    | managers.state_manager:create_initial_state:254 - New state created with preserved data
2025-01-10 16:28:16 | DEBUG    | managers.state_manager:validate_state:176 - Validating state data: session_id='82f99646-14a1-4a8f-b219-7f807aa0e54a' game_id='e48e937f-430c-48a5-b35f-8fd0c3138493' metadata=None should_continue=False narrative=None rules=RulesModel(section_number=1, dice_type=<DiceType.NONE: 'none'>, needs_dice=False, needs_user_response=False, next_action=None, conditions=[], choices=[], rules_summary='', error=None, source='default', source_type=<SourceType.RAW: 'raw'>, last_update=datetime.datetime(2025, 1, 10, 16, 28, 16, 575594)) decision=DecisionModel(section_number=1, next_section=None, player_input=None, error=None, awaiting_action=<ActionType.USER_INPUT: 'user_input'>, conditions=[], timestamp=datetime.datetime(2025, 1, 10, 16, 28, 16, 575626), next_action=None) trace=None character=CharacterModel(name='Hero', stats=CharacterStats(endurance=20, chance=20, skill=20), inventory=Inventory(items={}, capacity=10, gold=0)) error=None section_number=1
2025-01-10 16:28:16 | DEBUG    | managers.state_manager:validate_state:179 - Input is GameState, narrative content: None
2025-01-10 16:28:16 | DEBUG    | managers.state_manager:_validate_format:135 - Validating format for state, narrative content: None
2025-01-10 16:28:16 | DEBUG    | managers.state_manager:_validate_format:152 - Format validation successful, narrative content: None
2025-01-10 16:28:16 | DEBUG    | managers.state_manager:save_state:395 - Saving state, input narrative content: None
2025-01-10 16:28:16 | DEBUG    | managers.state_manager:validate_state:176 - Validating state data: session_id='82f99646-14a1-4a8f-b219-7f807aa0e54a' game_id='e48e937f-430c-48a5-b35f-8fd0c3138493' metadata=None should_continue=False narrative=None rules=RulesModel(section_number=1, dice_type=<DiceType.NONE: 'none'>, needs_dice=False, needs_user_response=False, next_action=None, conditions=[], choices=[], rules_summary='', error=None, source='default', source_type=<SourceType.RAW: 'raw'>, last_update=datetime.datetime(2025, 1, 10, 16, 28, 16, 575594)) decision=DecisionModel(section_number=1, next_section=None, player_input=None, error=None, awaiting_action=<ActionType.USER_INPUT: 'user_input'>, conditions=[], timestamp=datetime.datetime(2025, 1, 10, 16, 28, 16, 575626), next_action=None) trace=None character=CharacterModel(name='Hero', stats=CharacterStats(endurance=20, chance=20, skill=20), inventory=Inventory(items={}, capacity=10, gold=0)) error=None section_number=1
2025-01-10 16:28:16 | DEBUG    | managers.state_manager:validate_state:179 - Input is GameState, narrative content: None
2025-01-10 16:28:16 | DEBUG    | managers.state_manager:_validate_format:135 - Validating format for state, narrative content: None
2025-01-10 16:28:16 | DEBUG    | managers.state_manager:_validate_format:152 - Format validation successful, narrative content: None
2025-01-10 16:28:16 | DEBUG    | managers.state_manager:save_state:403 - State validated, narrative content: None
2025-01-10 16:28:16 | DEBUG    | managers.state_manager:save_state:408 - State serialized, narrative content in json: None
2025-01-10 16:28:16 | DEBUG    | managers.cache_manager:save_cached_data:151 - Saving data for key game_e48e937f-430c-48a5-b35f-8fd0c3138493_current in namespace state
2025-01-10 16:28:16 | DEBUG    | managers.cache_manager:save_cached_data:170 - Serializing data for storage
2025-01-10 16:28:16 | DEBUG    | managers.cache_manager:_serialize_data:72 - Serializing data for namespace state with format StorageFormat.JSON
2025-01-10 16:28:16 | DEBUG    | managers.cache_manager:save_cached_data:173 - Saving to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_current.json
2025-01-10 16:28:16 | DEBUG    | managers.filesystem_adapter:write_file_async:67 - Writing to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_current.json
2025-01-10 16:28:16 | DEBUG    | managers.filesystem_adapter:write_file_async:82 - Successfully wrote to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_current.json
2025-01-10 16:28:16 | INFO     | managers.cache_manager:save_cached_data:175 - Successfully saved data for state/game_e48e937f-430c-48a5-b35f-8fd0c3138493_current
2025-01-10 16:28:16 | DEBUG    | managers.state_manager:save_state:417 - Current state saved to cache
2025-01-10 16:28:16 | DEBUG    | managers.cache_manager:save_cached_data:151 - Saving data for key game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_1 in namespace state
2025-01-10 16:28:16 | DEBUG    | managers.cache_manager:save_cached_data:170 - Serializing data for storage
2025-01-10 16:28:16 | DEBUG    | managers.cache_manager:_serialize_data:72 - Serializing data for namespace state with format StorageFormat.JSON
2025-01-10 16:28:16 | DEBUG    | managers.cache_manager:save_cached_data:173 - Saving to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_1.json
2025-01-10 16:28:16 | DEBUG    | managers.filesystem_adapter:write_file_async:67 - Writing to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_1.json
2025-01-10 16:28:16 | DEBUG    | managers.filesystem_adapter:write_file_async:82 - Successfully wrote to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_1.json
2025-01-10 16:28:16 | INFO     | managers.cache_manager:save_cached_data:175 - Successfully saved data for state/game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_1
2025-01-10 16:28:16 | DEBUG    | managers.state_manager:save_state:425 - Section state saved to cache
2025-01-10 16:28:16 | DEBUG    | managers.state_manager:save_state:428 - Current state updated, final narrative content: None
2025-01-10 16:28:16 | INFO     | managers.agent_manager:get_story_workflow:256 - Getting story workflow
2025-01-10 16:28:16 | DEBUG    | managers.agent_manager:get_story_workflow:260 - Story graph not configured, configuring now
2025-01-10 16:28:16 | DEBUG    | managers.agent_manager:get_story_workflow:269 - Compiling workflow
2025-01-10 16:28:16 | INFO     | agents.story_graph:_setup_workflow:81 - Setting up LangGraph workflow with parallel processing
2025-01-10 16:28:16 | SUCCESS  | agents.story_graph:_setup_workflow:120 - Workflow setup completed
2025-01-10 16:28:16 | DEBUG    | managers.agent_manager:_handle_game_workflow:199 - [WORKFLOW] State before modification: {'session_id': '82f99646-14a1-4a8f-b219-7f807aa0e54a', 'game_id': 'e48e937f-430c-48a5-b35f-8fd0c3138493', 'should_continue': False, 'rules': {'section_number': 1, 'dice_type': <DiceType.NONE: 'none'>, 'needs_dice': False, 'needs_user_response': False, 'conditions': [], 'choices': [], 'rules_summary': '', 'source': 'default', 'source_type': <SourceType.RAW: 'raw'>, 'last_update': datetime.datetime(2025, 1, 10, 16, 28, 16, 575594)}, 'decision': {'section_number': 1, 'awaiting_action': <ActionType.USER_INPUT: 'user_input'>, 'conditions': [], 'timestamp': datetime.datetime(2025, 1, 10, 16, 28, 16, 575626)}, 'character': {'name': 'Hero', 'stats': {'endurance': 20, 'chance': 20, 'skill': 20}, 'inventory': {'items': {}, 'capacity': 10, 'gold': 0}}, 'section_number': 1}
2025-01-10 16:28:16 | DEBUG    | managers.agent_manager:_handle_game_workflow:201 - [WORKFLOW] Initial state_dict: player_input=None, thread_id=e48e937f-430c-48a5-b35f-8fd0c3138493
2025-01-10 16:28:16 | DEBUG    | managers.agent_manager:_handle_game_workflow:215 - [WORKFLOW] Starting new workflow with thread_id=e48e937f-430c-48a5-b35f-8fd0c3138493
2025-01-10 16:28:17 | INFO     | managers.workflow_manager:start_workflow:111 - Starting workflow
2025-01-10 16:28:17 | INFO     | managers.state_manager:create_initial_state:224 - Creating initial state
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:create_initial_state:232 - Preserved data extracted: {'session_id': '82f99646-14a1-4a8f-b219-7f807aa0e54a', 'game_id': 'e48e937f-430c-48a5-b35f-8fd0c3138493', 'section_number': 1, 'character': CharacterModel(name='Hero', stats=CharacterStats(endurance=20, chance=20, skill=20), inventory=Inventory(items={}, capacity=10, gold=0))}
2025-01-10 16:28:17 | INFO     | managers.state_manager:clear_model_nodes:581 - Clearing model nodes
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:clear_model_nodes:594 - Model nodes cleared
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:create_initial_state:236 - Existing state cleared
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:create_initial_state:254 - New state created with preserved data
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:validate_state:176 - Validating state data: session_id='82f99646-14a1-4a8f-b219-7f807aa0e54a' game_id='e48e937f-430c-48a5-b35f-8fd0c3138493' metadata=None should_continue=False narrative=None rules=RulesModel(section_number=1, dice_type=<DiceType.NONE: 'none'>, needs_dice=False, needs_user_response=False, next_action=None, conditions=[], choices=[], rules_summary='', error=None, source='default', source_type=<SourceType.RAW: 'raw'>, last_update=datetime.datetime(2025, 1, 10, 16, 28, 17, 574338)) decision=DecisionModel(section_number=1, next_section=None, player_input=None, error=None, awaiting_action=<ActionType.USER_INPUT: 'user_input'>, conditions=[], timestamp=datetime.datetime(2025, 1, 10, 16, 28, 17, 574369), next_action=None) trace=None character=CharacterModel(name='Hero', stats=CharacterStats(endurance=20, chance=20, skill=20), inventory=Inventory(items={}, capacity=10, gold=0)) error=None section_number=1
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:validate_state:179 - Input is GameState, narrative content: None
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:_validate_format:135 - Validating format for state, narrative content: None
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:_validate_format:152 - Format validation successful, narrative content: None
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:save_state:395 - Saving state, input narrative content: None
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:validate_state:176 - Validating state data: session_id='82f99646-14a1-4a8f-b219-7f807aa0e54a' game_id='e48e937f-430c-48a5-b35f-8fd0c3138493' metadata=None should_continue=False narrative=None rules=RulesModel(section_number=1, dice_type=<DiceType.NONE: 'none'>, needs_dice=False, needs_user_response=False, next_action=None, conditions=[], choices=[], rules_summary='', error=None, source='default', source_type=<SourceType.RAW: 'raw'>, last_update=datetime.datetime(2025, 1, 10, 16, 28, 17, 574338)) decision=DecisionModel(section_number=1, next_section=None, player_input=None, error=None, awaiting_action=<ActionType.USER_INPUT: 'user_input'>, conditions=[], timestamp=datetime.datetime(2025, 1, 10, 16, 28, 17, 574369), next_action=None) trace=None character=CharacterModel(name='Hero', stats=CharacterStats(endurance=20, chance=20, skill=20), inventory=Inventory(items={}, capacity=10, gold=0)) error=None section_number=1
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:validate_state:179 - Input is GameState, narrative content: None
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:_validate_format:135 - Validating format for state, narrative content: None
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:_validate_format:152 - Format validation successful, narrative content: None
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:save_state:403 - State validated, narrative content: None
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:save_state:408 - State serialized, narrative content in json: None
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:save_cached_data:151 - Saving data for key game_e48e937f-430c-48a5-b35f-8fd0c3138493_current in namespace state
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:save_cached_data:170 - Serializing data for storage
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:_serialize_data:72 - Serializing data for namespace state with format StorageFormat.JSON
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:save_cached_data:173 - Saving to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_current.json
2025-01-10 16:28:17 | DEBUG    | managers.filesystem_adapter:write_file_async:67 - Writing to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_current.json
2025-01-10 16:28:17 | DEBUG    | managers.filesystem_adapter:write_file_async:82 - Successfully wrote to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_current.json
2025-01-10 16:28:17 | INFO     | managers.cache_manager:save_cached_data:175 - Successfully saved data for state/game_e48e937f-430c-48a5-b35f-8fd0c3138493_current
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:save_state:417 - Current state saved to cache
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:save_cached_data:151 - Saving data for key game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_1 in namespace state
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:save_cached_data:170 - Serializing data for storage
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:_serialize_data:72 - Serializing data for namespace state with format StorageFormat.JSON
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:save_cached_data:173 - Saving to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_1.json
2025-01-10 16:28:17 | DEBUG    | managers.filesystem_adapter:write_file_async:67 - Writing to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_1.json
2025-01-10 16:28:17 | DEBUG    | managers.filesystem_adapter:write_file_async:82 - Successfully wrote to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_1.json
2025-01-10 16:28:17 | INFO     | managers.cache_manager:save_cached_data:175 - Successfully saved data for state/game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_1
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:save_state:425 - Section state saved to cache
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:save_state:428 - Current state updated, final narrative content: None
2025-01-10 16:28:17 | DEBUG    | models.game_state:with_updates:329 - Creating new state with updates for session_id=82f99646-14a1-4a8f-b219-7f807aa0e54a
2025-01-10 16:28:17 | DEBUG    | models.game_state:with_updates:330 - Creating new state with updates for section_number=1
2025-01-10 16:28:17 | DEBUG    | managers.workflow_manager:start_workflow:119 - Full state in start_workflow before return: {'session_id': '82f99646-14a1-4a8f-b219-7f807aa0e54a', 'game_id': 'e48e937f-430c-48a5-b35f-8fd0c3138493', 'metadata': {'node': 'start'}, 'should_continue': False, 'narrative': None, 'rules': {'section_number': 1, 'dice_type': <DiceType.NONE: 'none'>, 'needs_dice': False, 'needs_user_response': False, 'next_action': None, 'conditions': [], 'choices': [], 'rules_summary': '', 'error': None, 'source': 'default', 'source_type': <SourceType.RAW: 'raw'>, 'last_update': datetime.datetime(2025, 1, 10, 16, 28, 17, 621705)}, 'decision': {'section_number': 1, 'next_section': None, 'player_input': None, 'error': None, 'awaiting_action': <ActionType.USER_INPUT: 'user_input'>, 'conditions': [], 'timestamp': datetime.datetime(2025, 1, 10, 16, 28, 17, 621847), 'next_action': None}, 'trace': None, 'character': {'name': 'Hero', 'stats': {'endurance': 20, 'chance': 20, 'skill': 20}, 'inventory': {'items': {}, 'capacity': 10, 'gold': 0}}, 'error': None, 'section_number': 1}
2025-01-10 16:28:17 | INFO     | managers.workflow_manager:start_workflow:120 - Workflow started successfully: session=82f99646-14a1-4a8f-b219-7f807aa0e54a, game=e48e937f-430c-48a5-b35f-8fd0c3138493, section=1
2025-01-10 16:28:17 | INFO     | agents.story_graph:_process_narrative:158 - Processing narrative for section 1
2025-01-10 16:28:17 | DEBUG    | agents.narrator_agent:ainvoke:202 - Processing narrative for state: session=82f99646-14a1-4a8f-b219-7f807aa0e54a, section=1
2025-01-10 16:28:17 | DEBUG    | agents.narrator_agent:_process_section:49 - Starting process_section for section 1
2025-01-10 16:28:17 | INFO     | managers.narrator_manager:get_cached_content:35 - Getting cached content for section 1
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:get_cached_data:184 - Getting data for key section_1 in namespace sections
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:get_cached_data:208 - Looking for file: C:\Users\erpes\Desktop\casys-rpg\data\cache\sections\section_1.md
2025-01-10 16:28:17 | DEBUG    | managers.filesystem_adapter:read_file_async:100 - Reading from file: C:\Users\erpes\Desktop\casys-rpg\data\cache\sections\section_1.md
2025-01-10 16:28:17 | INFO     | agents.story_graph:_process_rules:128 - Processing rules for section 1
2025-01-10 16:28:17 | DEBUG    | agents.rules_agent:ainvoke:238 - Processing rules for state: session=82f99646-14a1-4a8f-b219-7f807aa0e54a, section=1
2025-01-10 16:28:17 | DEBUG    | agents.rules_agent:_process_section_rules:54 - Starting process_section_rules for section 1
2025-01-10 16:28:17 | INFO     | managers.rules_manager:get_cached_rules:38 - Getting cached rules for section 1
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:get_cached_data:184 - Getting data for key section_1_rules in namespace rules
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:get_cached_data:208 - Looking for file: C:\Users\erpes\Desktop\casys-rpg\data\cache\rules\section_1_rules.md
2025-01-10 16:28:17 | DEBUG    | managers.filesystem_adapter:read_file_async:100 - Reading from file: C:\Users\erpes\Desktop\casys-rpg\data\cache\rules\section_1_rules.md
2025-01-10 16:28:17 | DEBUG    | managers.filesystem_adapter:read_file_async:117 - Successfully read from file: C:\Users\erpes\Desktop\casys-rpg\data\cache\sections\section_1.md (2539 characters)
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:get_cached_data:213 - Found in persistent storage
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:_deserialize_data:107 - Deserializing data for namespace sections with format StorageFormat.MARKDOWN
2025-01-10 16:28:17 | DEBUG    | managers.narrator_manager:_markdown_to_narrator:151 - Converting markdown to NarratorModel for section 1
2025-01-10 16:28:17 | DEBUG    | managers.narrator_manager:get_cached_content:48 - Successfully parsed cached content for section 1
2025-01-10 16:28:17 | INFO     | agents.narrator_agent:_process_section:54 - Content found in cache for section 1
2025-01-10 16:28:17 | DEBUG    | agents.narrator_agent:_process_section:55 - Cached narrative content: Vous vous enfoncez confortablement dans le siège antigravitationnel, face aux commandes de votre vai...
2025-01-10 16:28:17 | DEBUG    | agents.story_graph:_process_narrative:174 - Received narrative content from agent: Vous vous enfoncez confortablement dans le siège antigravitationnel, face aux commandes de votre vai...
2025-01-10 16:28:17 | DEBUG    | models.game_state:with_updates:329 - Creating new state with updates for session_id=82f99646-14a1-4a8f-b219-7f807aa0e54a
2025-01-10 16:28:17 | DEBUG    | models.game_state:with_updates:330 - Creating new state with updates for section_number=1
2025-01-10 16:28:17 | DEBUG    | managers.filesystem_adapter:read_file_async:117 - Successfully read from file: C:\Users\erpes\Desktop\casys-rpg\data\cache\rules\section_1_rules.md (565 characters)
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:get_cached_data:213 - Found in persistent storage
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:_deserialize_data:107 - Deserializing data for namespace rules with format StorageFormat.MARKDOWN
2025-01-10 16:28:17 | DEBUG    | managers.rules_manager:_markdown_to_rules:260 - Parsing markdown content for section 1
2025-01-10 16:28:17 | DEBUG    | managers.rules_manager:_markdown_to_rules:279 - Parsed sections: ['Metadata', 'Analysis', 'Choices', 'Summary', 'Error']
2025-01-10 16:28:17 | DEBUG    | managers.rules_manager:_markdown_to_rules:298 - Parsed metadata: {'last_update': '2025-01-09T14:31:21.866475', 'source': 'llm_analysis', 'source_type': 'processed'}
2025-01-10 16:28:17 | DEBUG    | managers.rules_manager:_markdown_to_rules:318 - Parsed analysis: {'needs_dice': 'false', 'dice_type': 'none', 'needs_user_response': 'true', 'next_action': 'None', 'conditions': 'None', 'target_sections': '48, 398'}
2025-01-10 16:28:17 | DEBUG    | managers.rules_manager:_parse_choices:192 - Parsing choices from content
2025-01-10 16:28:17 | DEBUG    | managers.rules_manager:_parse_choices:202 - Parsing choice: 'Engager la procédure d'évasion'
2025-01-10 16:28:17 | DEBUG    | managers.rules_manager:_parse_choices:218 - Parsed dice type: none
2025-01-10 16:28:17 | DEBUG    | managers.rules_manager:_parse_choices:235 - Parsed target section: 48
2025-01-10 16:28:17 | DEBUG    | managers.rules_manager:_parse_choices:250 - Choice parsed successfully: 'Engager la procédure d'évasion'
2025-01-10 16:28:17 | DEBUG    | managers.rules_manager:_parse_choices:202 - Parsing choice: 'Continuer votre route'
2025-01-10 16:28:17 | DEBUG    | managers.rules_manager:_parse_choices:218 - Parsed dice type: none
2025-01-10 16:28:17 | DEBUG    | managers.rules_manager:_parse_choices:235 - Parsed target section: 398
2025-01-10 16:28:17 | DEBUG    | managers.rules_manager:_parse_choices:250 - Choice parsed successfully: 'Continuer votre route'
2025-01-10 16:28:17 | INFO     | managers.rules_manager:_parse_choices:255 - Successfully parsed 2 choices
2025-01-10 16:28:17 | DEBUG    | managers.rules_manager:_markdown_to_rules:328 - Parsed 2 choices
2025-01-10 16:28:17 | DEBUG    | managers.rules_manager:_markdown_to_rules:373 - Creating RulesModel with data: {'section_number': 1, 'dice_type': <DiceType.NONE: 'none'>, 'needs_dice': False, 'needs_user_response': True, 'next_action': None, 'conditions': [], 'choices_count': 2, 'source': 'llm_analysis', 'source_type': <SourceType.PROCESSED: 'processed'>}
2025-01-10 16:28:17 | INFO     | managers.rules_manager:_markdown_to_rules:385 - Successfully created RulesModel for section 1
2025-01-10 16:28:17 | INFO     | managers.rules_manager:get_cached_rules:51 - Successfully retrieved rules for section 1 from cache
2025-01-10 16:28:17 | INFO     | agents.rules_agent:_process_section_rules:59 - Rules found in cache for section 1
2025-01-10 16:28:17 | DEBUG    | agents.story_graph:_process_rules:144 - Received rules from agent: section_number=1 dice_type=<DiceType.NONE: 'none'> needs_dice=False needs_user_response=True next_action=None conditions=[] choices=[Choice(text="Engager la procédure d'évasion", type=<ChoiceType.DIRECT: 'direct'>, target_section=48, conditions=[], dice_type=<DiceType.NONE: 'none'>, dice_results={}), Choice(text='Continuer votre route', type=<ChoiceType.DIRECT: 'direct'>, target_section=398, conditions=[], dice_type=<DiceType.NONE: 'none'>, dice_results={})] rules_summary="Le joueur doit choisir entre engager la procédure d'évasion ou continuer sa route." error=None source='llm_analysis' source_type=<SourceType.PROCESSED: 'processed'> last_update=datetime.datetime(2025, 1, 9, 14, 31, 21, 866475)
2025-01-10 16:28:17 | DEBUG    | models.game_state:with_updates:329 - Creating new state with updates for session_id=82f99646-14a1-4a8f-b219-7f807aa0e54a
2025-01-10 16:28:17 | DEBUG    | models.game_state:with_updates:330 - Creating new state with updates for section_number=1
2025-01-10 16:28:17 | INFO     | agents.story_graph:_process_decision:202 - Waiting for user input in section 1
2025-01-10 16:28:17 | INFO     | agents.story_graph:_process_decision:286 - Workflow interrupted for user input: (Interrupt(value='[DECISION] Waiting for user input', resumable=True, ns=['node_decision:d80be026-dba9-851d-b3b8-e8ff4c0ddf6a'], when='during'),)
2025-01-10 16:28:17 | DEBUG    | managers.agent_manager:_handle_game_workflow:221 - StateSnapshot retrieved: player_input=None
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:save_state:395 - Saving state, input narrative content: Vous vous enfoncez confortablement dans le siège antigravitationnel, face aux commandes de votre vai...
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:validate_state:176 - Validating state data: session_id='82f99646-14a1-4a8f-b219-7f807aa0e54a' game_id='e48e937f-430c-48a5-b35f-8fd0c3138493' metadata={'node': 'start'} should_continue=False narrative=NarratorModel(section_number=1, content="Vous vous enfoncez confortablement dans le siège antigravitationnel, face aux commandes de votre vaisseau spatial. Après avoir vérifié le système de sécurité, vous examinez attentivement le tableau de bord. Il ne présente aucune complexité : une simple console d'ordinateur reliée à un terminal de liaison et quelques écrans.\n\nLe circuit micro-électronique du système alpha ziridium est profondément enfoui dans les entrailles du vaisseau, et vous n'aurez jamais à vous en préoccuper le moins du monde. Si une panne quelconque venait à se déclarer, ou s'il se produisait le moindre incident, votre ingénieur robot interviendrait sur-le-champ.\n\nLa préprogrammation de votre voyage a été établie pour vous mener en premier lieu sur Tropos. Vous entamez les procédures de départ : interrogation de l'ordinateur concernant tous les points vitaux du vaisseau. Une voix impersonnelle se fait entendre aussitôt : « Vérifications effectuées. Fonctionnement optimal. »\n\nPuis vous passez à la deuxième opération : contact avec la tour de contrôle. Paré au décollage ! Vous appuyez sur un bouton... et c'est le grand voyage. Au bout de quelques minutes, les malaises dus à l'accélération s'estompent : vous quittez l'exosphère terrienne et pénétrez dans la nuit spatiale, aussi noire que de l'encre.\n\nLe générateur gravitationnel est automatiquement enclenché, de sorte que la pesanteur normale est maintenue dans votre vaisseau, ce qui vous permet, ainsi qu'à vos robots, de vous déplacer librement. Vous allumez l'écran de vision rétrospective pour observer une dernière fois la Terre qui rétrécit et s'éloigne. Des bancs de nuages glissent paresseusement et le soleil se réfléchit sur les glaces polaires du cercle arctique.\n\nBien que l'occasion vous ait été donnée à maintes reprises de contempler ce spectacle au cours de vos voyages vers Vénus ou vers Mercure, vous ressentez toujours, à sa vue, un petit pincement au cœur et une émotion nostalgique. Reverrez-vous jamais la Terre ? D'un haussement d'épaules, vous chassez ces pensées car seul, compte, désormais, votre mission.\n\nDes heures s'écoulent, uniformes et lentes. Puis votre écran revient soudain à la vie. L'ordinateur de bord vous avertit qu'un autre vaisseau spatial suit la même trajectoire que vous tout en maintenant soigneusement un écart constant. Cela ressemble à s'y méprendre à une filature.\n\nAllez-vous donner l'ordre à votre ordinateur d'engager la procédure d'évasion (rendez-vous au [[48]]) ou préférez-vous continuer votre route (rendez-vous au [[398]]) ?", source_type=<SourceType.RAW: 'raw'>, error=None, timestamp=datetime.datetime(2025, 1, 10, 16, 28, 17, 665422), last_update=datetime.datetime(2025, 1, 10, 16, 28, 17, 665445)) rules=RulesModel(section_number=1, dice_type=<DiceType.NONE: 'none'>, needs_dice=False, needs_user_response=True, next_action=None, conditions=[], choices=[Choice(text="Engager la procédure d'évasion", type=<ChoiceType.DIRECT: 'direct'>, target_section=48, conditions=[], dice_type=<DiceType.NONE: 'none'>, dice_results={}), Choice(text='Continuer votre route', type=<ChoiceType.DIRECT: 'direct'>, target_section=398, conditions=[], dice_type=<DiceType.NONE: 'none'>, dice_results={})], rules_summary="Le joueur doit choisir entre engager la procédure d'évasion ou continuer sa route.", error=None, source='llm_analysis', source_type=<SourceType.PROCESSED: 'processed'>, last_update=datetime.datetime(2025, 1, 9, 14, 31, 21, 866475)) decision=DecisionModel(section_number=1, next_section=None, player_input=None, error=None, awaiting_action=<ActionType.USER_INPUT: 'user_input'>, conditions=[], timestamp=datetime.datetime(2025, 1, 10, 16, 28, 17, 693596), next_action=None) trace=None character=CharacterModel(name='Hero', stats=CharacterStats(endurance=20, chance=20, skill=20), inventory=Inventory(items={}, capacity=10, gold=0)) error=None section_number=1
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:validate_state:179 - Input is GameState, narrative content: Vous vous enfoncez confortablement dans le siège antigravitationnel, face aux commandes de votre vai...
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:_validate_format:135 - Validating format for state, narrative content: Vous vous enfoncez confortablement dans le siège antigravitationnel, face aux commandes de votre vai...
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:_validate_format:145 - Checking narrative content: Vous vous enfoncez confortablement dans le siège antigravitationnel, face aux commandes de votre vai...
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:_validate_format:152 - Format validation successful, narrative content: Vous vous enfoncez confortablement dans le siège antigravitationnel, face aux commandes de votre vai...
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:save_state:403 - State validated, narrative content: Vous vous enfoncez confortablement dans le siège antigravitationnel, face aux commandes de votre vai...
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:save_state:408 - State serialized, narrative content in json: Vous vous enfoncez confortablement dans le siège antigravitationnel, face aux commandes de votre vai...
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:save_cached_data:151 - Saving data for key game_e48e937f-430c-48a5-b35f-8fd0c3138493_current in namespace state
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:save_cached_data:170 - Serializing data for storage
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:_serialize_data:72 - Serializing data for namespace state with format StorageFormat.JSON
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:save_cached_data:173 - Saving to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_current.json
2025-01-10 16:28:17 | DEBUG    | managers.filesystem_adapter:write_file_async:67 - Writing to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_current.json
2025-01-10 16:28:17 | DEBUG    | managers.filesystem_adapter:write_file_async:82 - Successfully wrote to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_current.json
2025-01-10 16:28:17 | INFO     | managers.cache_manager:save_cached_data:175 - Successfully saved data for state/game_e48e937f-430c-48a5-b35f-8fd0c3138493_current
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:save_state:417 - Current state saved to cache
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:save_cached_data:151 - Saving data for key game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_1 in namespace state
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:save_cached_data:170 - Serializing data for storage
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:_serialize_data:72 - Serializing data for namespace state with format StorageFormat.JSON
2025-01-10 16:28:17 | DEBUG    | managers.cache_manager:save_cached_data:173 - Saving to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_1.json
2025-01-10 16:28:17 | DEBUG    | managers.filesystem_adapter:write_file_async:67 - Writing to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_1.json
2025-01-10 16:28:17 | DEBUG    | managers.filesystem_adapter:write_file_async:82 - Successfully wrote to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_1.json
2025-01-10 16:28:17 | INFO     | managers.cache_manager:save_cached_data:175 - Successfully saved data for state/game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_1
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:save_state:425 - Section state saved to cache
2025-01-10 16:28:17 | DEBUG    | managers.state_manager:save_state:428 - Current state updated, final narrative content: Vous vous enfoncez confortablement dans le siège antigravitationnel, face aux commandes de votre vai...
2025-01-10 16:28:17 | DEBUG    | managers.dependencies:get_agent_manager:81 - Returning existing AgentManager instance
2025-01-10 16:28:17 | DEBUG    | managers.dependencies:get_agent_manager:81 - Returning existing AgentManager instance
2025-01-10 16:28:17 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:70 - New WebSocket connection attempt
2025-01-10 16:28:18 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:78 - WebSocket connection established
2025-01-10 16:28:18 | DEBUG    | managers.agent_manager:get_state:107 - Fetching current game state
2025-01-10 16:28:18 | DEBUG    | managers.agent_manager:get_state:109 - Current state: session_id='82f99646-14a1-4a8f-b219-7f807aa0e54a' game_id='e48e937f-430c-48a5-b35f-8fd0c3138493' metadata={'node': 'start'} should_continue=False narrative=NarratorModel(section_number=1, content="Vous vous enfoncez confortablement dans le siège antigravitationnel, face aux commandes de votre vaisseau spatial. Après avoir vérifié le système de sécurité, vous examinez attentivement le tableau de bord. Il ne présente aucune complexité : une simple console d'ordinateur reliée à un terminal de liaison et quelques écrans.\n\nLe circuit micro-électronique du système alpha ziridium est profondément enfoui dans les entrailles du vaisseau, et vous n'aurez jamais à vous en préoccuper le moins du monde. Si une panne quelconque venait à se déclarer, ou s'il se produisait le moindre incident, votre ingénieur robot interviendrait sur-le-champ.\n\nLa préprogrammation de votre voyage a été établie pour vous mener en premier lieu sur Tropos. Vous entamez les procédures de départ : interrogation de l'ordinateur concernant tous les points vitaux du vaisseau. Une voix impersonnelle se fait entendre aussitôt : « Vérifications effectuées. Fonctionnement optimal. »\n\nPuis vous passez à la deuxième opération : contact avec la tour de contrôle. Paré au décollage ! Vous appuyez sur un bouton... et c'est le grand voyage. Au bout de quelques minutes, les malaises dus à l'accélération s'estompent : vous quittez l'exosphère terrienne et pénétrez dans la nuit spatiale, aussi noire que de l'encre.\n\nLe générateur gravitationnel est automatiquement enclenché, de sorte que la pesanteur normale est maintenue dans votre vaisseau, ce qui vous permet, ainsi qu'à vos robots, de vous déplacer librement. Vous allumez l'écran de vision rétrospective pour observer une dernière fois la Terre qui rétrécit et s'éloigne. Des bancs de nuages glissent paresseusement et le soleil se réfléchit sur les glaces polaires du cercle arctique.\n\nBien que l'occasion vous ait été donnée à maintes reprises de contempler ce spectacle au cours de vos voyages vers Vénus ou vers Mercure, vous ressentez toujours, à sa vue, un petit pincement au cœur et une émotion nostalgique. Reverrez-vous jamais la Terre ? D'un haussement d'épaules, vous chassez ces pensées car seul, compte, désormais, votre mission.\n\nDes heures s'écoulent, uniformes et lentes. Puis votre écran revient soudain à la vie. L'ordinateur de bord vous avertit qu'un autre vaisseau spatial suit la même trajectoire que vous tout en maintenant soigneusement un écart constant. Cela ressemble à s'y méprendre à une filature.\n\nAllez-vous donner l'ordre à votre ordinateur d'engager la procédure d'évasion (rendez-vous au [[48]]) ou préférez-vous continuer votre route (rendez-vous au [[398]]) ?", source_type=<SourceType.RAW: 'raw'>, error=None, timestamp=datetime.datetime(2025, 1, 10, 16, 28, 17, 665422), last_update=datetime.datetime(2025, 1, 10, 16, 28, 17, 665445)) rules=RulesModel(section_number=1, dice_type=<DiceType.NONE: 'none'>, needs_dice=False, needs_user_response=True, next_action=None, conditions=[], choices=[Choice(text="Engager la procédure d'évasion", type=<ChoiceType.DIRECT: 'direct'>, target_section=48, conditions=[], dice_type=<DiceType.NONE: 'none'>, dice_results={}), Choice(text='Continuer votre route', type=<ChoiceType.DIRECT: 'direct'>, target_section=398, conditions=[], dice_type=<DiceType.NONE: 'none'>, dice_results={})], rules_summary="Le joueur doit choisir entre engager la procédure d'évasion ou continuer sa route.", error=None, source='llm_analysis', source_type=<SourceType.PROCESSED: 'processed'>, last_update=datetime.datetime(2025, 1, 9, 14, 31, 21, 866475)) decision=DecisionModel(section_number=1, next_section=None, player_input=None, error=None, awaiting_action=<ActionType.USER_INPUT: 'user_input'>, conditions=[], timestamp=datetime.datetime(2025, 1, 10, 16, 28, 17, 693596), next_action=None) trace=None character=CharacterModel(name='Hero', stats=CharacterStats(endurance=20, chance=20, skill=20), inventory=Inventory(items={}, capacity=10, gold=0)) error=None section_number=1
2025-01-10 16:28:18 | DEBUG    | managers.agent_manager:get_state:107 - Fetching current game state
2025-01-10 16:28:18 | DEBUG    | managers.agent_manager:get_state:109 - Current state: session_id='82f99646-14a1-4a8f-b219-7f807aa0e54a' game_id='e48e937f-430c-48a5-b35f-8fd0c3138493' metadata={'node': 'start'} should_continue=False narrative=NarratorModel(section_number=1, content="Vous vous enfoncez confortablement dans le siège antigravitationnel, face aux commandes de votre vaisseau spatial. Après avoir vérifié le système de sécurité, vous examinez attentivement le tableau de bord. Il ne présente aucune complexité : une simple console d'ordinateur reliée à un terminal de liaison et quelques écrans.\n\nLe circuit micro-électronique du système alpha ziridium est profondément enfoui dans les entrailles du vaisseau, et vous n'aurez jamais à vous en préoccuper le moins du monde. Si une panne quelconque venait à se déclarer, ou s'il se produisait le moindre incident, votre ingénieur robot interviendrait sur-le-champ.\n\nLa préprogrammation de votre voyage a été établie pour vous mener en premier lieu sur Tropos. Vous entamez les procédures de départ : interrogation de l'ordinateur concernant tous les points vitaux du vaisseau. Une voix impersonnelle se fait entendre aussitôt : « Vérifications effectuées. Fonctionnement optimal. »\n\nPuis vous passez à la deuxième opération : contact avec la tour de contrôle. Paré au décollage ! Vous appuyez sur un bouton... et c'est le grand voyage. Au bout de quelques minutes, les malaises dus à l'accélération s'estompent : vous quittez l'exosphère terrienne et pénétrez dans la nuit spatiale, aussi noire que de l'encre.\n\nLe générateur gravitationnel est automatiquement enclenché, de sorte que la pesanteur normale est maintenue dans votre vaisseau, ce qui vous permet, ainsi qu'à vos robots, de vous déplacer librement. Vous allumez l'écran de vision rétrospective pour observer une dernière fois la Terre qui rétrécit et s'éloigne. Des bancs de nuages glissent paresseusement et le soleil se réfléchit sur les glaces polaires du cercle arctique.\n\nBien que l'occasion vous ait été donnée à maintes reprises de contempler ce spectacle au cours de vos voyages vers Vénus ou vers Mercure, vous ressentez toujours, à sa vue, un petit pincement au cœur et une émotion nostalgique. Reverrez-vous jamais la Terre ? D'un haussement d'épaules, vous chassez ces pensées car seul, compte, désormais, votre mission.\n\nDes heures s'écoulent, uniformes et lentes. Puis votre écran revient soudain à la vie. L'ordinateur de bord vous avertit qu'un autre vaisseau spatial suit la même trajectoire que vous tout en maintenant soigneusement un écart constant. Cela ressemble à s'y méprendre à une filature.\n\nAllez-vous donner l'ordre à votre ordinateur d'engager la procédure d'évasion (rendez-vous au [[48]]) ou préférez-vous continuer votre route (rendez-vous au [[398]]) ?", source_type=<SourceType.RAW: 'raw'>, error=None, timestamp=datetime.datetime(2025, 1, 10, 16, 28, 17, 665422), last_update=datetime.datetime(2025, 1, 10, 16, 28, 17, 665445)) rules=RulesModel(section_number=1, dice_type=<DiceType.NONE: 'none'>, needs_dice=False, needs_user_response=True, next_action=None, conditions=[], choices=[Choice(text="Engager la procédure d'évasion", type=<ChoiceType.DIRECT: 'direct'>, target_section=48, conditions=[], dice_type=<DiceType.NONE: 'none'>, dice_results={}), Choice(text='Continuer votre route', type=<ChoiceType.DIRECT: 'direct'>, target_section=398, conditions=[], dice_type=<DiceType.NONE: 'none'>, dice_results={})], rules_summary="Le joueur doit choisir entre engager la procédure d'évasion ou continuer sa route.", error=None, source='llm_analysis', source_type=<SourceType.PROCESSED: 'processed'>, last_update=datetime.datetime(2025, 1, 9, 14, 31, 21, 866475)) decision=DecisionModel(section_number=1, next_section=None, player_input=None, error=None, awaiting_action=<ActionType.USER_INPUT: 'user_input'>, conditions=[], timestamp=datetime.datetime(2025, 1, 10, 16, 28, 17, 693596), next_action=None) trace=None character=CharacterModel(name='Hero', stats=CharacterStats(endurance=20, chance=20, skill=20), inventory=Inventory(items={}, capacity=10, gold=0)) error=None section_number=1
2025-01-10 16:29:25 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:120 - Processing user choice
2025-01-10 16:29:25 | DEBUG    | api.routes.ws.game_route_ws:game_websocket_endpoint:123 - Received choice data: {'type': 'choice', 'choice': {'game_id': 'e48e937f-430c-48a5-b35f-8fd0c3138493', 'choice_id': '48', 'choice_text': "Engager la procédure d'évasion", 'metadata': {'type': 'direct', 'target_section': 48, 'conditions': [], 'dice_type': 'none', 'dice_results': {}}}}
2025-01-10 16:29:25 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:136 - Processing choice: game_id='e48e937f-430c-48a5-b35f-8fd0c3138493' choice_id='48' choice_text="Engager la procédure d'évasion" metadata={'type': 'direct', 'target_section': 48, 'conditions': [], 'dice_type': 'none', 'dice_results': {}}
2025-01-10 16:29:25 | DEBUG    | managers.agent_manager:get_state:107 - Fetching current game state
2025-01-10 16:29:25 | DEBUG    | managers.agent_manager:get_state:109 - Current state: session_id='82f99646-14a1-4a8f-b219-7f807aa0e54a' game_id='e48e937f-430c-48a5-b35f-8fd0c3138493' metadata={'node': 'start'} should_continue=False narrative=NarratorModel(section_number=1, content="Vous vous enfoncez confortablement dans le siège antigravitationnel, face aux commandes de votre vaisseau spatial. Après avoir vérifié le système de sécurité, vous examinez attentivement le tableau de bord. Il ne présente aucune complexité : une simple console d'ordinateur reliée à un terminal de liaison et quelques écrans.\n\nLe circuit micro-électronique du système alpha ziridium est profondément enfoui dans les entrailles du vaisseau, et vous n'aurez jamais à vous en préoccuper le moins du monde. Si une panne quelconque venait à se déclarer, ou s'il se produisait le moindre incident, votre ingénieur robot interviendrait sur-le-champ.\n\nLa préprogrammation de votre voyage a été établie pour vous mener en premier lieu sur Tropos. Vous entamez les procédures de départ : interrogation de l'ordinateur concernant tous les points vitaux du vaisseau. Une voix impersonnelle se fait entendre aussitôt : « Vérifications effectuées. Fonctionnement optimal. »\n\nPuis vous passez à la deuxième opération : contact avec la tour de contrôle. Paré au décollage ! Vous appuyez sur un bouton... et c'est le grand voyage. Au bout de quelques minutes, les malaises dus à l'accélération s'estompent : vous quittez l'exosphère terrienne et pénétrez dans la nuit spatiale, aussi noire que de l'encre.\n\nLe générateur gravitationnel est automatiquement enclenché, de sorte que la pesanteur normale est maintenue dans votre vaisseau, ce qui vous permet, ainsi qu'à vos robots, de vous déplacer librement. Vous allumez l'écran de vision rétrospective pour observer une dernière fois la Terre qui rétrécit et s'éloigne. Des bancs de nuages glissent paresseusement et le soleil se réfléchit sur les glaces polaires du cercle arctique.\n\nBien que l'occasion vous ait été donnée à maintes reprises de contempler ce spectacle au cours de vos voyages vers Vénus ou vers Mercure, vous ressentez toujours, à sa vue, un petit pincement au cœur et une émotion nostalgique. Reverrez-vous jamais la Terre ? D'un haussement d'épaules, vous chassez ces pensées car seul, compte, désormais, votre mission.\n\nDes heures s'écoulent, uniformes et lentes. Puis votre écran revient soudain à la vie. L'ordinateur de bord vous avertit qu'un autre vaisseau spatial suit la même trajectoire que vous tout en maintenant soigneusement un écart constant. Cela ressemble à s'y méprendre à une filature.\n\nAllez-vous donner l'ordre à votre ordinateur d'engager la procédure d'évasion (rendez-vous au [[48]]) ou préférez-vous continuer votre route (rendez-vous au [[398]]) ?", source_type=<SourceType.RAW: 'raw'>, error=None, timestamp=datetime.datetime(2025, 1, 10, 16, 28, 17, 665422), last_update=datetime.datetime(2025, 1, 10, 16, 28, 17, 665445)) rules=RulesModel(section_number=1, dice_type=<DiceType.NONE: 'none'>, needs_dice=False, needs_user_response=True, next_action=None, conditions=[], choices=[Choice(text="Engager la procédure d'évasion", type=<ChoiceType.DIRECT: 'direct'>, target_section=48, conditions=[], dice_type=<DiceType.NONE: 'none'>, dice_results={}), Choice(text='Continuer votre route', type=<ChoiceType.DIRECT: 'direct'>, target_section=398, conditions=[], dice_type=<DiceType.NONE: 'none'>, dice_results={})], rules_summary="Le joueur doit choisir entre engager la procédure d'évasion ou continuer sa route.", error=None, source='llm_analysis', source_type=<SourceType.PROCESSED: 'processed'>, last_update=datetime.datetime(2025, 1, 9, 14, 31, 21, 866475)) decision=DecisionModel(section_number=1, next_section=None, player_input=None, error=None, awaiting_action=<ActionType.USER_INPUT: 'user_input'>, conditions=[], timestamp=datetime.datetime(2025, 1, 10, 16, 28, 17, 693596), next_action=None) trace=None character=CharacterModel(name='Hero', stats=CharacterStats(endurance=20, chance=20, skill=20), inventory=Inventory(items={}, capacity=10, gold=0)) error=None section_number=1
2025-01-10 16:29:25 | INFO     | managers.agent_manager:get_story_workflow:256 - Getting story workflow
2025-01-10 16:29:25 | DEBUG    | managers.agent_manager:_handle_game_workflow:199 - [WORKFLOW] State before modification: {'session_id': '82f99646-14a1-4a8f-b219-7f807aa0e54a', 'game_id': 'e48e937f-430c-48a5-b35f-8fd0c3138493', 'metadata': {'node': 'start'}, 'should_continue': False, 'narrative': {'section_number': 1, 'content': "Vous vous enfoncez confortablement dans le siège antigravitationnel, face aux commandes de votre vaisseau spatial. Après avoir vérifié le système de sécurité, vous examinez attentivement le tableau de bord. Il ne présente aucune complexité : une simple console d'ordinateur reliée à un terminal de liaison et quelques écrans.\n\nLe circuit micro-électronique du système alpha ziridium est profondément enfoui dans les entrailles du vaisseau, et vous n'aurez jamais à vous en préoccuper le moins du monde. Si une panne quelconque venait à se déclarer, ou s'il se produisait le moindre incident, votre ingénieur robot interviendrait sur-le-champ.\n\nLa préprogrammation de votre voyage a été établie pour vous mener en premier lieu sur Tropos. Vous entamez les procédures de départ : interrogation de l'ordinateur concernant tous les points vitaux du vaisseau. Une voix impersonnelle se fait entendre aussitôt : « Vérifications effectuées. Fonctionnement optimal. »\n\nPuis vous passez à la deuxième opération : contact avec la tour de contrôle. Paré au décollage ! Vous appuyez sur un bouton... et c'est le grand voyage. Au bout de quelques minutes, les malaises dus à l'accélération s'estompent : vous quittez l'exosphère terrienne et pénétrez dans la nuit spatiale, aussi noire que de l'encre.\n\nLe générateur gravitationnel est automatiquement enclenché, de sorte que la pesanteur normale est maintenue dans votre vaisseau, ce qui vous permet, ainsi qu'à vos robots, de vous déplacer librement. Vous allumez l'écran de vision rétrospective pour observer une dernière fois la Terre qui rétrécit et s'éloigne. Des bancs de nuages glissent paresseusement et le soleil se réfléchit sur les glaces polaires du cercle arctique.\n\nBien que l'occasion vous ait été donnée à maintes reprises de contempler ce spectacle au cours de vos voyages vers Vénus ou vers Mercure, vous ressentez toujours, à sa vue, un petit pincement au cœur et une émotion nostalgique. Reverrez-vous jamais la Terre ? D'un haussement d'épaules, vous chassez ces pensées car seul, compte, désormais, votre mission.\n\nDes heures s'écoulent, uniformes et lentes. Puis votre écran revient soudain à la vie. L'ordinateur de bord vous avertit qu'un autre vaisseau spatial suit la même trajectoire que vous tout en maintenant soigneusement un écart constant. Cela ressemble à s'y méprendre à une filature.\n\nAllez-vous donner l'ordre à votre ordinateur d'engager la procédure d'évasion (rendez-vous au [[48]]) ou préférez-vous continuer votre route (rendez-vous au [[398]]) ?", 'source_type': <SourceType.RAW: 'raw'>, 'timestamp': datetime.datetime(2025, 1, 10, 16, 28, 17, 665422), 'last_update': datetime.datetime(2025, 1, 10, 16, 28, 17, 665445)}, 'rules': {'section_number': 1, 'dice_type': <DiceType.NONE: 'none'>, 'needs_dice': False, 'needs_user_response': True, 'conditions': [], 'choices': [{'text': "Engager la procédure d'évasion", 'type': <ChoiceType.DIRECT: 'direct'>, 'target_section': 48, 'conditions': [], 'dice_type': <DiceType.NONE: 'none'>, 'dice_results': {}}, {'text': 'Continuer votre route', 'type': <ChoiceType.DIRECT: 'direct'>, 'target_section': 398, 'conditions': [], 'dice_type': <DiceType.NONE: 'none'>, 'dice_results': {}}], 'rules_summary': "Le joueur doit choisir entre engager la procédure d'évasion ou continuer sa route.", 'source': 'llm_analysis', 'source_type': <SourceType.PROCESSED: 'processed'>, 'last_update': datetime.datetime(2025, 1, 9, 14, 31, 21, 866475)}, 'decision': {'section_number': 1, 'awaiting_action': <ActionType.USER_INPUT: 'user_input'>, 'conditions': [], 'timestamp': datetime.datetime(2025, 1, 10, 16, 28, 17, 693596)}, 'character': {'name': 'Hero', 'stats': {'endurance': 20, 'chance': 20, 'skill': 20}, 'inventory': {'items': {}, 'capacity': 10, 'gold': 0}}, 'section_number': 1}
2025-01-10 16:29:25 | DEBUG    | managers.agent_manager:_handle_game_workflow:201 - [WORKFLOW] Initial state_dict: player_input=None, thread_id=e48e937f-430c-48a5-b35f-8fd0c3138493
2025-01-10 16:29:25 | INFO     | managers.agent_manager:_handle_game_workflow:207 - Resuming workflow with user_input=Engager la procédure d'évasion
2025-01-10 16:29:25 | DEBUG    | managers.agent_manager:_handle_game_workflow:209 - [WORKFLOW] Command data: {'player_input': "Engager la procédure d'évasion"} (type=<class 'dict'>)
2025-01-10 16:29:25 | DEBUG    | managers.agent_manager:_handle_game_workflow:210 - [WORKFLOW] Sending Command(resume={'player_input': "Engager la procédure d'évasion"}) with thread_id=e48e937f-430c-48a5-b35f-8fd0c3138493
2025-01-10 16:29:25 | INFO     | agents.story_graph:_process_decision:202 - Waiting for user input in section 1
2025-01-10 16:29:25 | DEBUG    | agents.story_graph:_process_decision:204 - [DECISION] Received interrupt response: {'player_input': "Engager la procédure d'évasion"} (type=<class 'dict'>)
2025-01-10 16:29:25 | DEBUG    | agents.story_graph:_process_decision:213 - [DECISION] Extracted player_input from dict: Engager la procédure d'évasion
2025-01-10 16:29:25 | DEBUG    | models.game_state:with_updates:329 - Creating new state with updates for session_id=82f99646-14a1-4a8f-b219-7f807aa0e54a
2025-01-10 16:29:25 | DEBUG    | models.game_state:with_updates:330 - Creating new state with updates for section_number=1
2025-01-10 16:29:25 | INFO     | agents.story_graph:_process_decision:234 - [DECISION] Processing decision for section 1 (cycle with_input)
2025-01-10 16:29:25 | DEBUG    | agents.story_graph:_process_decision:246 - [DECISION] Current player_input value: Engager la procédure d'évasion, section_number=1
2025-01-10 16:29:25 | DEBUG    | agents.story_graph:_process_decision:249 - [DECISION] Input data rules: needs_user_response=True, has_player_input=True
2025-01-10 16:29:25 | INFO     | agents.story_graph:_process_decision:261 - [DECISION] Processing decision with input: Engager la procédure d'évasion
2025-01-10 16:29:25 | DEBUG    | agents.decision_agent:ainvoke:175 - Full state in decision: {'session_id': '82f99646-14a1-4a8f-b219-7f807aa0e54a', 'game_id': 'e48e937f-430c-48a5-b35f-8fd0c3138493', 'metadata': {'node': 'start'}, 'should_continue': False, 'narrative': {'section_number': 1, 'content': "Vous vous enfoncez confortablement dans le siège antigravitationnel, face aux commandes de votre vaisseau spatial. Après avoir vérifié le système de sécurité, vous examinez attentivement le tableau de bord. Il ne présente aucune complexité : une simple console d'ordinateur reliée à un terminal de liaison et quelques écrans.\n\nLe circuit micro-électronique du système alpha ziridium est profondément enfoui dans les entrailles du vaisseau, et vous n'aurez jamais à vous en préoccuper le moins du monde. Si une panne quelconque venait à se déclarer, ou s'il se produisait le moindre incident, votre ingénieur robot interviendrait sur-le-champ.\n\nLa préprogrammation de votre voyage a été établie pour vous mener en premier lieu sur Tropos. Vous entamez les procédures de départ : interrogation de l'ordinateur concernant tous les points vitaux du vaisseau. Une voix impersonnelle se fait entendre aussitôt : « Vérifications effectuées. Fonctionnement optimal. »\n\nPuis vous passez à la deuxième opération : contact avec la tour de contrôle. Paré au décollage ! Vous appuyez sur un bouton... et c'est le grand voyage. Au bout de quelques minutes, les malaises dus à l'accélération s'estompent : vous quittez l'exosphère terrienne et pénétrez dans la nuit spatiale, aussi noire que de l'encre.\n\nLe générateur gravitationnel est automatiquement enclenché, de sorte que la pesanteur normale est maintenue dans votre vaisseau, ce qui vous permet, ainsi qu'à vos robots, de vous déplacer librement. Vous allumez l'écran de vision rétrospective pour observer une dernière fois la Terre qui rétrécit et s'éloigne. Des bancs de nuages glissent paresseusement et le soleil se réfléchit sur les glaces polaires du cercle arctique.\n\nBien que l'occasion vous ait été donnée à maintes reprises de contempler ce spectacle au cours de vos voyages vers Vénus ou vers Mercure, vous ressentez toujours, à sa vue, un petit pincement au cœur et une émotion nostalgique. Reverrez-vous jamais la Terre ? D'un haussement d'épaules, vous chassez ces pensées car seul, compte, désormais, votre mission.\n\nDes heures s'écoulent, uniformes et lentes. Puis votre écran revient soudain à la vie. L'ordinateur de bord vous avertit qu'un autre vaisseau spatial suit la même trajectoire que vous tout en maintenant soigneusement un écart constant. Cela ressemble à s'y méprendre à une filature.\n\nAllez-vous donner l'ordre à votre ordinateur d'engager la procédure d'évasion (rendez-vous au [[48]]) ou préférez-vous continuer votre route (rendez-vous au [[398]]) ?", 'source_type': <SourceType.RAW: 'raw'>, 'error': None, 'timestamp': datetime.datetime(2025, 1, 10, 16, 28, 17, 665422), 'last_update': datetime.datetime(2025, 1, 10, 16, 28, 17, 665445)}, 'rules': {'section_number': 1, 'dice_type': <DiceType.NONE: 'none'>, 'needs_dice': False, 'needs_user_response': True, 'next_action': None, 'conditions': [], 'choices': [{'text': "Engager la procédure d'évasion", 'type': <ChoiceType.DIRECT: 'direct'>, 'target_section': 48, 'conditions': [], 'dice_type': <DiceType.NONE: 'none'>, 'dice_results': {}}, {'text': 'Continuer votre route', 'type': <ChoiceType.DIRECT: 'direct'>, 'target_section': 398, 'conditions': [], 'dice_type': <DiceType.NONE: 'none'>, 'dice_results': {}}], 'rules_summary': "Le joueur doit choisir entre engager la procédure d'évasion ou continuer sa route.", 'error': None, 'source': 'llm_analysis', 'source_type': <SourceType.PROCESSED: 'processed'>, 'last_update': datetime.datetime(2025, 1, 9, 14, 31, 21, 866475)}, 'decision': {'section_number': 1, 'next_section': None, 'player_input': "Engager la procédure d'évasion", 'error': None, 'awaiting_action': <ActionType.USER_INPUT: 'user_input'>, 'conditions': [], 'timestamp': datetime.datetime(2025, 1, 10, 16, 29, 25, 519713), 'next_action': None}, 'trace': None, 'character': {'name': 'Hero', 'stats': {'endurance': 20, 'chance': 20, 'skill': 20}, 'inventory': {'items': {}, 'capacity': 10, 'gold': 0}}, 'error': None, 'section_number': 1}
2025-01-10 16:29:25 | INFO     | agents.decision_agent:ainvoke:176 - Starting decision processing: session=82f99646-14a1-4a8f-b219-7f807aa0e54a, game=e48e937f-430c-48a5-b35f-8fd0c3138493, section=1, input=Engager la procédure d'évasion
2025-01-10 16:29:25 | INFO     | agents.decision_agent:_process_decision:101 - Processing decision for section 1 with input: Engager la procédure d'évasion
2025-01-10 16:29:25 | DEBUG    | agents.decision_agent:_process_decision:113 - Rules state: needs_dice=False, next_action=None
2025-01-10 16:29:25 | INFO     | agents.decision_agent:_process_decision:144 - Analyzing user response
2025-01-10 16:29:26 | INFO     | agents.decision_agent:_process_decision:151 - Analysis complete: current_section=1, next_section=48
2025-01-10 16:29:26 | INFO     | agents.decision_agent:ainvoke:196 - Decision processed successfully: next_section=48
2025-01-10 16:29:26 | DEBUG    | agents.story_graph:_process_decision:265 - [DECISION] Decision result: section_number=1 next_section=48 player_input=None error=None awaiting_action=<ActionType.USER_INPUT: 'user_input'> conditions=[] timestamp=datetime.datetime(2025, 1, 10, 16, 29, 26, 694012) next_action=None
2025-01-10 16:29:26 | INFO     | agents.story_graph:_process_decision:275 - Decision processed: current_section=1, next_section=48
2025-01-10 16:29:26 | DEBUG    | models.game_state:with_updates:329 - Creating new state with updates for session_id=82f99646-14a1-4a8f-b219-7f807aa0e54a
2025-01-10 16:29:26 | DEBUG    | models.game_state:with_updates:330 - Creating new state with updates for section_number=1
2025-01-10 16:29:26 | DEBUG    | models.game_state:with_updates:329 - Creating new state with updates for session_id=82f99646-14a1-4a8f-b219-7f807aa0e54a
2025-01-10 16:29:26 | DEBUG    | models.game_state:with_updates:330 - Creating new state with updates for section_number=1
2025-01-10 16:29:26 | DEBUG    | agents.story_graph:should_continue_condition:105 - Condition state details: {'session_id': '82f99646-14a1-4a8f-b219-7f807aa0e54a', 'game_id': 'e48e937f-430c-48a5-b35f-8fd0c3138493', 'metadata': {'node': 'start'}, 'should_continue': True, 'narrative': {'section_number': 1, 'content': "Vous vous enfoncez confortablement dans le siège antigravitationnel, face aux commandes de votre vaisseau spatial. Après avoir vérifié le système de sécurité, vous examinez attentivement le tableau de bord. Il ne présente aucune complexité : une simple console d'ordinateur reliée à un terminal de liaison et quelques écrans.\n\nLe circuit micro-électronique du système alpha ziridium est profondément enfoui dans les entrailles du vaisseau, et vous n'aurez jamais à vous en préoccuper le moins du monde. Si une panne quelconque venait à se déclarer, ou s'il se produisait le moindre incident, votre ingénieur robot interviendrait sur-le-champ.\n\nLa préprogrammation de votre voyage a été établie pour vous mener en premier lieu sur Tropos. Vous entamez les procédures de départ : interrogation de l'ordinateur concernant tous les points vitaux du vaisseau. Une voix impersonnelle se fait entendre aussitôt : « Vérifications effectuées. Fonctionnement optimal. »\n\nPuis vous passez à la deuxième opération : contact avec la tour de contrôle. Paré au décollage ! Vous appuyez sur un bouton... et c'est le grand voyage. Au bout de quelques minutes, les malaises dus à l'accélération s'estompent : vous quittez l'exosphère terrienne et pénétrez dans la nuit spatiale, aussi noire que de l'encre.\n\nLe générateur gravitationnel est automatiquement enclenché, de sorte que la pesanteur normale est maintenue dans votre vaisseau, ce qui vous permet, ainsi qu'à vos robots, de vous déplacer librement. Vous allumez l'écran de vision rétrospective pour observer une dernière fois la Terre qui rétrécit et s'éloigne. Des bancs de nuages glissent paresseusement et le soleil se réfléchit sur les glaces polaires du cercle arctique.\n\nBien que l'occasion vous ait été donnée à maintes reprises de contempler ce spectacle au cours de vos voyages vers Vénus ou vers Mercure, vous ressentez toujours, à sa vue, un petit pincement au cœur et une émotion nostalgique. Reverrez-vous jamais la Terre ? D'un haussement d'épaules, vous chassez ces pensées car seul, compte, désormais, votre mission.\n\nDes heures s'écoulent, uniformes et lentes. Puis votre écran revient soudain à la vie. L'ordinateur de bord vous avertit qu'un autre vaisseau spatial suit la même trajectoire que vous tout en maintenant soigneusement un écart constant. Cela ressemble à s'y méprendre à une filature.\n\nAllez-vous donner l'ordre à votre ordinateur d'engager la procédure d'évasion (rendez-vous au [[48]]) ou préférez-vous continuer votre route (rendez-vous au [[398]]) ?", 'source_type': <SourceType.RAW: 'raw'>, 'error': None, 'timestamp': datetime.datetime(2025, 1, 10, 16, 28, 17, 665422), 'last_update': datetime.datetime(2025, 1, 10, 16, 28, 17, 665445)}, 'rules': {'section_number': 1, 'dice_type': <DiceType.NONE: 'none'>, 'needs_dice': False, 'needs_user_response': True, 'next_action': None, 'conditions': [], 'choices': [{'text': "Engager la procédure d'évasion", 'type': <ChoiceType.DIRECT: 'direct'>, 'target_section': 48, 'conditions': [], 'dice_type': <DiceType.NONE: 'none'>, 'dice_results': {}}, {'text': 'Continuer votre route', 'type': <ChoiceType.DIRECT: 'direct'>, 'target_section': 398, 'conditions': [], 'dice_type': <DiceType.NONE: 'none'>, 'dice_results': {}}], 'rules_summary': "Le joueur doit choisir entre engager la procédure d'évasion ou continuer sa route.", 'error': None, 'source': 'llm_analysis', 'source_type': <SourceType.PROCESSED: 'processed'>, 'last_update': datetime.datetime(2025, 1, 9, 14, 31, 21, 866475)}, 'decision': {'section_number': 1, 'next_section': 48, 'player_input': None, 'error': None, 'awaiting_action': <ActionType.USER_INPUT: 'user_input'>, 'conditions': [], 'timestamp': datetime.datetime(2025, 1, 10, 16, 29, 26, 701265), 'next_action': None}, 'trace': None, 'character': {'name': 'Hero', 'stats': {'endurance': 20, 'chance': 20, 'skill': 20}, 'inventory': {'items': {}, 'capacity': 10, 'gold': 0}}, 'error': None, 'section_number': 1}
2025-01-10 16:29:26 | INFO     | agents.story_graph:should_continue_condition:106 - [WORKFLOW] Evaluating should_continue=True for section 1
2025-01-10 16:29:26 | INFO     | managers.workflow_manager:start_workflow:111 - Starting workflow
2025-01-10 16:29:26 | INFO     | managers.state_manager:create_initial_state:224 - Creating initial state
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:create_initial_state:232 - Preserved data extracted: {'session_id': '82f99646-14a1-4a8f-b219-7f807aa0e54a', 'game_id': 'e48e937f-430c-48a5-b35f-8fd0c3138493', 'section_number': 48, 'character': CharacterModel(name='Hero', stats=CharacterStats(endurance=20, chance=20, skill=20), inventory=Inventory(items={}, capacity=10, gold=0))}
2025-01-10 16:29:26 | INFO     | managers.state_manager:clear_model_nodes:581 - Clearing model nodes
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:clear_model_nodes:594 - Model nodes cleared
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:create_initial_state:236 - Existing state cleared
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:create_initial_state:254 - New state created with preserved data
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:validate_state:176 - Validating state data: session_id='82f99646-14a1-4a8f-b219-7f807aa0e54a' game_id='e48e937f-430c-48a5-b35f-8fd0c3138493' metadata=None should_continue=False narrative=None rules=RulesModel(section_number=48, dice_type=<DiceType.NONE: 'none'>, needs_dice=False, needs_user_response=False, next_action=None, conditions=[], choices=[], rules_summary='', error=None, source='default', source_type=<SourceType.RAW: 'raw'>, last_update=datetime.datetime(2025, 1, 10, 16, 29, 26, 884782)) decision=DecisionModel(section_number=48, next_section=None, player_input=None, error=None, awaiting_action=<ActionType.USER_INPUT: 'user_input'>, conditions=[], timestamp=datetime.datetime(2025, 1, 10, 16, 29, 26, 884795), next_action=None) trace=None character=CharacterModel(name='Hero', stats=CharacterStats(endurance=20, chance=20, skill=20), inventory=Inventory(items={}, capacity=10, gold=0)) error=None section_number=48
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:validate_state:179 - Input is GameState, narrative content: None
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:_validate_format:135 - Validating format for state, narrative content: None
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:_validate_format:152 - Format validation successful, narrative content: None
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:save_state:395 - Saving state, input narrative content: None
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:validate_state:176 - Validating state data: session_id='82f99646-14a1-4a8f-b219-7f807aa0e54a' game_id='e48e937f-430c-48a5-b35f-8fd0c3138493' metadata=None should_continue=False narrative=None rules=RulesModel(section_number=48, dice_type=<DiceType.NONE: 'none'>, needs_dice=False, needs_user_response=False, next_action=None, conditions=[], choices=[], rules_summary='', error=None, source='default', source_type=<SourceType.RAW: 'raw'>, last_update=datetime.datetime(2025, 1, 10, 16, 29, 26, 884782)) decision=DecisionModel(section_number=48, next_section=None, player_input=None, error=None, awaiting_action=<ActionType.USER_INPUT: 'user_input'>, conditions=[], timestamp=datetime.datetime(2025, 1, 10, 16, 29, 26, 884795), next_action=None) trace=None character=CharacterModel(name='Hero', stats=CharacterStats(endurance=20, chance=20, skill=20), inventory=Inventory(items={}, capacity=10, gold=0)) error=None section_number=48
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:validate_state:179 - Input is GameState, narrative content: None
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:_validate_format:135 - Validating format for state, narrative content: None
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:_validate_format:152 - Format validation successful, narrative content: None
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:save_state:403 - State validated, narrative content: None
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:save_state:408 - State serialized, narrative content in json: None
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:save_cached_data:151 - Saving data for key game_e48e937f-430c-48a5-b35f-8fd0c3138493_current in namespace state
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:save_cached_data:170 - Serializing data for storage
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:_serialize_data:72 - Serializing data for namespace state with format StorageFormat.JSON
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:save_cached_data:173 - Saving to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_current.json
2025-01-10 16:29:26 | DEBUG    | managers.filesystem_adapter:write_file_async:67 - Writing to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_current.json
2025-01-10 16:29:26 | DEBUG    | managers.filesystem_adapter:write_file_async:82 - Successfully wrote to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_current.json
2025-01-10 16:29:26 | INFO     | managers.cache_manager:save_cached_data:175 - Successfully saved data for state/game_e48e937f-430c-48a5-b35f-8fd0c3138493_current
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:save_state:417 - Current state saved to cache
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:save_cached_data:151 - Saving data for key game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_48 in namespace state
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:save_cached_data:170 - Serializing data for storage
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:_serialize_data:72 - Serializing data for namespace state with format StorageFormat.JSON
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:save_cached_data:173 - Saving to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_48.json
2025-01-10 16:29:26 | DEBUG    | managers.filesystem_adapter:write_file_async:67 - Writing to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_48.json
2025-01-10 16:29:26 | DEBUG    | managers.filesystem_adapter:write_file_async:82 - Successfully wrote to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_48.json
2025-01-10 16:29:26 | INFO     | managers.cache_manager:save_cached_data:175 - Successfully saved data for state/game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_48
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:save_state:425 - Section state saved to cache
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:save_state:428 - Current state updated, final narrative content: None
2025-01-10 16:29:26 | DEBUG    | models.game_state:with_updates:329 - Creating new state with updates for session_id=82f99646-14a1-4a8f-b219-7f807aa0e54a
2025-01-10 16:29:26 | DEBUG    | models.game_state:with_updates:330 - Creating new state with updates for section_number=48
2025-01-10 16:29:26 | DEBUG    | managers.workflow_manager:start_workflow:119 - Full state in start_workflow before return: {'session_id': '82f99646-14a1-4a8f-b219-7f807aa0e54a', 'game_id': 'e48e937f-430c-48a5-b35f-8fd0c3138493', 'metadata': {'node': 'start'}, 'should_continue': False, 'narrative': None, 'rules': {'section_number': 48, 'dice_type': <DiceType.NONE: 'none'>, 'needs_dice': False, 'needs_user_response': False, 'next_action': None, 'conditions': [], 'choices': [], 'rules_summary': '', 'error': None, 'source': 'default', 'source_type': <SourceType.RAW: 'raw'>, 'last_update': datetime.datetime(2025, 1, 10, 16, 29, 26, 898363)}, 'decision': {'section_number': 48, 'next_section': None, 'player_input': None, 'error': None, 'awaiting_action': <ActionType.USER_INPUT: 'user_input'>, 'conditions': [], 'timestamp': datetime.datetime(2025, 1, 10, 16, 29, 26, 898420), 'next_action': None}, 'trace': None, 'character': {'name': 'Hero', 'stats': {'endurance': 20, 'chance': 20, 'skill': 20}, 'inventory': {'items': {}, 'capacity': 10, 'gold': 0}}, 'error': None, 'section_number': 48}
2025-01-10 16:29:26 | INFO     | managers.workflow_manager:start_workflow:120 - Workflow started successfully: session=82f99646-14a1-4a8f-b219-7f807aa0e54a, game=e48e937f-430c-48a5-b35f-8fd0c3138493, section=48
2025-01-10 16:29:26 | INFO     | agents.story_graph:_process_narrative:158 - Processing narrative for section 48
2025-01-10 16:29:26 | DEBUG    | agents.narrator_agent:ainvoke:202 - Processing narrative for state: session=82f99646-14a1-4a8f-b219-7f807aa0e54a, section=48
2025-01-10 16:29:26 | DEBUG    | agents.narrator_agent:_process_section:49 - Starting process_section for section 48
2025-01-10 16:29:26 | INFO     | managers.narrator_manager:get_cached_content:35 - Getting cached content for section 48
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:get_cached_data:184 - Getting data for key section_48 in namespace sections
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:get_cached_data:208 - Looking for file: C:\Users\erpes\Desktop\casys-rpg\data\cache\sections\section_48.md
2025-01-10 16:29:26 | DEBUG    | managers.filesystem_adapter:read_file_async:100 - Reading from file: C:\Users\erpes\Desktop\casys-rpg\data\cache\sections\section_48.md
2025-01-10 16:29:26 | INFO     | agents.story_graph:_process_rules:128 - Processing rules for section 48
2025-01-10 16:29:26 | DEBUG    | agents.rules_agent:ainvoke:238 - Processing rules for state: session=82f99646-14a1-4a8f-b219-7f807aa0e54a, section=48
2025-01-10 16:29:26 | DEBUG    | agents.rules_agent:_process_section_rules:54 - Starting process_section_rules for section 48
2025-01-10 16:29:26 | INFO     | managers.rules_manager:get_cached_rules:38 - Getting cached rules for section 48
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:get_cached_data:184 - Getting data for key section_48_rules in namespace rules
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:get_cached_data:208 - Looking for file: C:\Users\erpes\Desktop\casys-rpg\data\cache\rules\section_48_rules.md
2025-01-10 16:29:26 | DEBUG    | managers.filesystem_adapter:read_file_async:100 - Reading from file: C:\Users\erpes\Desktop\casys-rpg\data\cache\rules\section_48_rules.md
2025-01-10 16:29:26 | DEBUG    | managers.filesystem_adapter:read_file_async:117 - Successfully read from file: C:\Users\erpes\Desktop\casys-rpg\data\cache\sections\section_48.md (717 characters)
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:get_cached_data:213 - Found in persistent storage
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:_deserialize_data:107 - Deserializing data for namespace sections with format StorageFormat.MARKDOWN
2025-01-10 16:29:26 | DEBUG    | managers.narrator_manager:_markdown_to_narrator:151 - Converting markdown to NarratorModel for section 48
2025-01-10 16:29:26 | DEBUG    | managers.narrator_manager:get_cached_content:48 - Successfully parsed cached content for section 48
2025-01-10 16:29:26 | INFO     | agents.narrator_agent:_process_section:54 - Content found in cache for section 48
2025-01-10 16:29:26 | DEBUG    | agents.narrator_agent:_process_section:55 - Cached narrative content: Vous avez beau programmer changement de trajectoire sur changement de trajectoire, vous ne parvenez ...
2025-01-10 16:29:26 | DEBUG    | agents.story_graph:_process_narrative:174 - Received narrative content from agent: Vous avez beau programmer changement de trajectoire sur changement de trajectoire, vous ne parvenez ...
2025-01-10 16:29:26 | DEBUG    | models.game_state:with_updates:329 - Creating new state with updates for session_id=82f99646-14a1-4a8f-b219-7f807aa0e54a
2025-01-10 16:29:26 | DEBUG    | models.game_state:with_updates:330 - Creating new state with updates for section_number=48
2025-01-10 16:29:26 | DEBUG    | managers.filesystem_adapter:read_file_async:117 - Successfully read from file: C:\Users\erpes\Desktop\casys-rpg\data\cache\rules\section_48_rules.md (476 characters)
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:get_cached_data:213 - Found in persistent storage
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:_deserialize_data:107 - Deserializing data for namespace rules with format StorageFormat.MARKDOWN
2025-01-10 16:29:26 | DEBUG    | managers.rules_manager:_markdown_to_rules:260 - Parsing markdown content for section 48
2025-01-10 16:29:26 | DEBUG    | managers.rules_manager:_markdown_to_rules:279 - Parsed sections: ['Metadata', 'Analysis', 'Choices', 'Summary', 'Error']
2025-01-10 16:29:26 | DEBUG    | managers.rules_manager:_markdown_to_rules:298 - Parsed metadata: {'last_update': '2025-01-09T14:32:17.373293', 'source': 'llm_analysis', 'source_type': 'processed'}
2025-01-10 16:29:26 | DEBUG    | managers.rules_manager:_markdown_to_rules:318 - Parsed analysis: {'needs_dice': 'false', 'dice_type': 'none', 'needs_user_response': 'true', 'next_action': 'None', 'conditions': 'None', 'target_sections': '164'}
2025-01-10 16:29:26 | DEBUG    | managers.rules_manager:_parse_choices:192 - Parsing choices from content
2025-01-10 16:29:26 | DEBUG    | managers.rules_manager:_parse_choices:202 - Parsing choice: 'Continuez vers Tropos'
2025-01-10 16:29:26 | DEBUG    | managers.rules_manager:_parse_choices:218 - Parsed dice type: none
2025-01-10 16:29:26 | DEBUG    | managers.rules_manager:_parse_choices:235 - Parsed target section: 164
2025-01-10 16:29:26 | DEBUG    | managers.rules_manager:_parse_choices:250 - Choice parsed successfully: 'Continuez vers Tropos'
2025-01-10 16:29:26 | INFO     | managers.rules_manager:_parse_choices:255 - Successfully parsed 1 choices
2025-01-10 16:29:26 | DEBUG    | managers.rules_manager:_markdown_to_rules:328 - Parsed 1 choices
2025-01-10 16:29:26 | DEBUG    | managers.rules_manager:_markdown_to_rules:373 - Creating RulesModel with data: {'section_number': 48, 'dice_type': <DiceType.NONE: 'none'>, 'needs_dice': False, 'needs_user_response': True, 'next_action': None, 'conditions': [], 'choices_count': 1, 'source': 'llm_analysis', 'source_type': <SourceType.PROCESSED: 'processed'>}
2025-01-10 16:29:26 | INFO     | managers.rules_manager:_markdown_to_rules:385 - Successfully created RulesModel for section 48
2025-01-10 16:29:26 | INFO     | managers.rules_manager:get_cached_rules:51 - Successfully retrieved rules for section 48 from cache
2025-01-10 16:29:26 | INFO     | agents.rules_agent:_process_section_rules:59 - Rules found in cache for section 48
2025-01-10 16:29:26 | DEBUG    | agents.story_graph:_process_rules:144 - Received rules from agent: section_number=48 dice_type=<DiceType.NONE: 'none'> needs_dice=False needs_user_response=True next_action=None conditions=[] choices=[Choice(text='Continuez vers Tropos', type=<ChoiceType.DIRECT: 'direct'>, target_section=164, conditions=[], dice_type=<DiceType.NONE: 'none'>, dice_results={})] rules_summary='Vous ne devez pas lancer de dés et vous devez simplement continuer vers la section 164.' error=None source='llm_analysis' source_type=<SourceType.PROCESSED: 'processed'> last_update=datetime.datetime(2025, 1, 9, 14, 32, 17, 373293)
2025-01-10 16:29:26 | DEBUG    | models.game_state:with_updates:329 - Creating new state with updates for session_id=82f99646-14a1-4a8f-b219-7f807aa0e54a
2025-01-10 16:29:26 | DEBUG    | models.game_state:with_updates:330 - Creating new state with updates for section_number=48
2025-01-10 16:29:26 | INFO     | agents.story_graph:_process_decision:202 - Waiting for user input in section 48
2025-01-10 16:29:26 | INFO     | agents.story_graph:_process_decision:286 - Workflow interrupted for user input: (Interrupt(value='[DECISION] Waiting for user input', resumable=True, ns=['node_decision:57827176-7507-ae61-3fb4-14b64449895e'], when='during'),)
2025-01-10 16:29:26 | DEBUG    | managers.agent_manager:_handle_game_workflow:221 - StateSnapshot retrieved: player_input=None
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:save_state:395 - Saving state, input narrative content: Vous avez beau programmer changement de trajectoire sur changement de trajectoire, vous ne parvenez ...
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:validate_state:176 - Validating state data: session_id='82f99646-14a1-4a8f-b219-7f807aa0e54a' game_id='e48e937f-430c-48a5-b35f-8fd0c3138493' metadata={'node': 'start'} should_continue=False narrative=NarratorModel(section_number=48, content="Vous avez beau programmer changement de trajectoire sur changement de trajectoire, vous ne parvenez pas à vous débarrasser de votre poursuivant. Vous abandonnez donc la partie, vous résignant à reprendre le chemin le plus direct vers Tropos.\n\nPour distraire votre attention, vous mangez, vous dormez et vous faites quelques exercices physiques avant de vous lancer dans une partie d'échecs contre votre ordinateur, réglé sur ses capacités logiques artificielles les plus simples. Les heures s'écoulent ainsi, votre « ange gardien » vous suivant fidèlement.\n\nCependant, lorsque vous pénétrez dans la zone d'approche de Tropos, il accélère subitement afin de se poser devant vous.\n\nRendez-vous au [[164]].", source_type=<SourceType.RAW: 'raw'>, error=None, timestamp=datetime.datetime(2025, 1, 10, 16, 29, 26, 927737), last_update=datetime.datetime(2025, 1, 10, 16, 29, 26, 927755)) rules=RulesModel(section_number=48, dice_type=<DiceType.NONE: 'none'>, needs_dice=False, needs_user_response=True, next_action=None, conditions=[], choices=[Choice(text='Continuez vers Tropos', type=<ChoiceType.DIRECT: 'direct'>, target_section=164, conditions=[], dice_type=<DiceType.NONE: 'none'>, dice_results={})], rules_summary='Vous ne devez pas lancer de dés et vous devez simplement continuer vers la section 164.', error=None, source='llm_analysis', source_type=<SourceType.PROCESSED: 'processed'>, last_update=datetime.datetime(2025, 1, 9, 14, 32, 17, 373293)) decision=DecisionModel(section_number=48, next_section=None, player_input=None, error=None, awaiting_action=<ActionType.USER_INPUT: 'user_input'>, conditions=[], timestamp=datetime.datetime(2025, 1, 10, 16, 29, 26, 940903), next_action=None) trace=None character=CharacterModel(name='Hero', stats=CharacterStats(endurance=20, chance=20, skill=20), inventory=Inventory(items={}, capacity=10, gold=0)) error=None section_number=48
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:validate_state:179 - Input is GameState, narrative content: Vous avez beau programmer changement de trajectoire sur changement de trajectoire, vous ne parvenez ...
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:_validate_format:135 - Validating format for state, narrative content: Vous avez beau programmer changement de trajectoire sur changement de trajectoire, vous ne parvenez ...
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:_validate_format:145 - Checking narrative content: Vous avez beau programmer changement de trajectoire sur changement de trajectoire, vous ne parvenez ...
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:_validate_format:152 - Format validation successful, narrative content: Vous avez beau programmer changement de trajectoire sur changement de trajectoire, vous ne parvenez ...
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:save_state:403 - State validated, narrative content: Vous avez beau programmer changement de trajectoire sur changement de trajectoire, vous ne parvenez ...
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:save_state:408 - State serialized, narrative content in json: Vous avez beau programmer changement de trajectoire sur changement de trajectoire, vous ne parvenez ...
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:save_cached_data:151 - Saving data for key game_e48e937f-430c-48a5-b35f-8fd0c3138493_current in namespace state
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:save_cached_data:170 - Serializing data for storage
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:_serialize_data:72 - Serializing data for namespace state with format StorageFormat.JSON
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:save_cached_data:173 - Saving to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_current.json
2025-01-10 16:29:26 | DEBUG    | managers.filesystem_adapter:write_file_async:67 - Writing to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_current.json
2025-01-10 16:29:26 | DEBUG    | managers.filesystem_adapter:write_file_async:82 - Successfully wrote to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_current.json
2025-01-10 16:29:26 | INFO     | managers.cache_manager:save_cached_data:175 - Successfully saved data for state/game_e48e937f-430c-48a5-b35f-8fd0c3138493_current
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:save_state:417 - Current state saved to cache
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:save_cached_data:151 - Saving data for key game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_48 in namespace state
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:save_cached_data:170 - Serializing data for storage
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:_serialize_data:72 - Serializing data for namespace state with format StorageFormat.JSON
2025-01-10 16:29:26 | DEBUG    | managers.cache_manager:save_cached_data:173 - Saving to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_48.json
2025-01-10 16:29:26 | DEBUG    | managers.filesystem_adapter:write_file_async:67 - Writing to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_48.json
2025-01-10 16:29:26 | DEBUG    | managers.filesystem_adapter:write_file_async:82 - Successfully wrote to file: C:\Users\erpes\Desktop\casys-rpg\data\cache\games\e48e937f-430c-48a5-b35f-8fd0c3138493\states\game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_48.json
2025-01-10 16:29:26 | INFO     | managers.cache_manager:save_cached_data:175 - Successfully saved data for state/game_e48e937f-430c-48a5-b35f-8fd0c3138493_section_48
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:save_state:425 - Section state saved to cache
2025-01-10 16:29:26 | DEBUG    | managers.state_manager:save_state:428 - Current state updated, final narrative content: Vous avez beau programmer changement de trajectoire sur changement de trajectoire, vous ne parvenez ...
2025-01-10 16:29:26 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:143 - Broadcasting new state after choice
2025-01-10 16:29:34 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:158 - WebSocket disconnected
2025-01-10 16:29:34 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:172 - WebSocket connection closed
2025-01-10 16:29:34 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:158 - WebSocket disconnected
2025-01-10 16:29:34 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:172 - WebSocket connection closed
2025-01-10 16:29:35 | DEBUG    | managers.dependencies:get_agent_manager:81 - Returning existing AgentManager instance
2025-01-10 16:29:35 | DEBUG    | managers.dependencies:get_agent_manager:81 - Returning existing AgentManager instance
2025-01-10 16:29:35 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:70 - New WebSocket connection attempt
2025-01-10 16:29:35 | INFO     | api.routes.ws.game_route_ws:game_websocket_endpoint:78 - WebSocket connection established
2025-01-10 16:29:35 | DEBUG    | managers.agent_manager:get_state:107 - Fetching current game state
2025-01-10 16:29:35 | DEBUG    | managers.agent_manager:get_state:109 - Current state: session_id='82f99646-14a1-4a8f-b219-7f807aa0e54a' game_id='e48e937f-430c-48a5-b35f-8fd0c3138493' metadata={'node': 'start'} should_continue=False narrative=NarratorModel(section_number=48, content="Vous avez beau programmer changement de trajectoire sur changement de trajectoire, vous ne parvenez pas à vous débarrasser de votre poursuivant. Vous abandonnez donc la partie, vous résignant à reprendre le chemin le plus direct vers Tropos.\n\nPour distraire votre attention, vous mangez, vous dormez et vous faites quelques exercices physiques avant de vous lancer dans une partie d'échecs contre votre ordinateur, réglé sur ses capacités logiques artificielles les plus simples. Les heures s'écoulent ainsi, votre « ange gardien » vous suivant fidèlement.\n\nCependant, lorsque vous pénétrez dans la zone d'approche de Tropos, il accélère subitement afin de se poser devant vous.\n\nRendez-vous au [[164]].", source_type=<SourceType.RAW: 'raw'>, error=None, timestamp=datetime.datetime(2025, 1, 10, 16, 29, 26, 927737), last_update=datetime.datetime(2025, 1, 10, 16, 29, 26, 927755)) rules=RulesModel(section_number=48, dice_type=<DiceType.NONE: 'none'>, needs_dice=False, needs_user_response=True, next_action=None, conditions=[], choices=[Choice(text='Continuez vers Tropos', type=<ChoiceType.DIRECT: 'direct'>, target_section=164, conditions=[], dice_type=<DiceType.NONE: 'none'>, dice_results={})], rules_summary='Vous ne devez pas lancer de dés et vous devez simplement continuer vers la section 164.', error=None, source='llm_analysis', source_type=<SourceType.PROCESSED: 'processed'>, last_update=datetime.datetime(2025, 1, 9, 14, 32, 17, 373293)) decision=DecisionModel(section_number=48, next_section=None, player_input=None, error=None, awaiting_action=<ActionType.USER_INPUT: 'user_input'>, conditions=[], timestamp=datetime.datetime(2025, 1, 10, 16, 29, 26, 940903), next_action=None) trace=None character=CharacterModel(name='Hero', stats=CharacterStats(endurance=20, chance=20, skill=20), inventory=Inventory(items={}, capacity=10, gold=0)) error=None section_number=48
2025-01-10 16:29:35 | DEBUG    | managers.agent_manager:get_state:107 - Fetching current game state
2025-01-10 16:29:35 | DEBUG    | managers.agent_manager:get_state:109 - Current state: session_id='82f99646-14a1-4a8f-b219-7f807aa0e54a' game_id='e48e937f-430c-48a5-b35f-8fd0c3138493' metadata={'node': 'start'} should_continue=False narrative=NarratorModel(section_number=48, content="Vous avez beau programmer changement de trajectoire sur changement de trajectoire, vous ne parvenez pas à vous débarrasser de votre poursuivant. Vous abandonnez donc la partie, vous résignant à reprendre le chemin le plus direct vers Tropos.\n\nPour distraire votre attention, vous mangez, vous dormez et vous faites quelques exercices physiques avant de vous lancer dans une partie d'échecs contre votre ordinateur, réglé sur ses capacités logiques artificielles les plus simples. Les heures s'écoulent ainsi, votre « ange gardien » vous suivant fidèlement.\n\nCependant, lorsque vous pénétrez dans la zone d'approche de Tropos, il accélère subitement afin de se poser devant vous.\n\nRendez-vous au [[164]].", source_type=<SourceType.RAW: 'raw'>, error=None, timestamp=datetime.datetime(2025, 1, 10, 16, 29, 26, 927737), last_update=datetime.datetime(2025, 1, 10, 16, 29, 26, 927755)) rules=RulesModel(section_number=48, dice_type=<DiceType.NONE: 'none'>, needs_dice=False, needs_user_response=True, next_action=None, conditions=[], choices=[Choice(text='Continuez vers Tropos', type=<ChoiceType.DIRECT: 'direct'>, target_section=164, conditions=[], dice_type=<DiceType.NONE: 'none'>, dice_results={})], rules_summary='Vous ne devez pas lancer de dés et vous devez simplement continuer vers la section 164.', error=None, source='llm_analysis', source_type=<SourceType.PROCESSED: 'processed'>, last_update=datetime.datetime(2025, 1, 9, 14, 32, 17, 373293)) decision=DecisionModel(section_number=48, next_section=None, player_input=None, error=None, awaiting_action=<ActionType.USER_INPUT: 'user_input'>, conditions=[], timestamp=datetime.datetime(2025, 1, 10, 16, 29, 26, 940903), next_action=None) trace=None character=CharacterModel(name='Hero', stats=CharacterStats(endurance=20, chance=20, skill=20), inventory=Inventory(items={}, capacity=10, gold=0)) error=None section_number=48
